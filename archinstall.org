#+TITLE: archlinux install note

* archinstall
:PROPERTIES:
:header-args: :tangle archpackages/install.sh
:END:
** Setting
#+begin_src shell
disco=/dev/sda
wifi=0
#+end_src
** keyboard
loadkeys =/etc/vconsole.conf=
#+begin_src shell
mkdir -p /usr/local/share/kbd/keymaps
echo 'include "linux-with-two-alt-keys"
     keycode 29 = Caps_Lock
     keycode 58 = Control' > /usr/local/share/kbd/keymaps/personal.map
echo 'KEYMAP=/usr/local/share/kbd/keymaps/personal.map' > /etc/vconsole.conf
loadkeys /etc/vconsole.conf
#+end_src
** wifi network
#+begin_src shell
if [ $wifi -ne 0 ]
then
ip link set wlan0 up
wpa_passphrase "BSSID" "PASSWORD" > wifi.conf
wpa_supplicant -B -i wlan0 -c wifi.conf
dhcpcd dhclient
fi
#+end_src
** Time
#+begin_src shell
timedatectl set-ntp true
#+end_src
** Disk partition & format
#+begin_src shell
sgdisk --zap-all ${disco}
sgdisk ${disco} -n=1:0:+100M -t=1:ef00
sgdisk ${disco} -n=2:0:0 -t=2:8300

mkfs.fat -F32 ${disco}1
mkfs.btrfs -f -L "root"  ${disco}2
#+end_src
** Pacman Mirror
- edit =/etc/pacman.d/mirrorlist=
#+begin_src shell
echo 'Server = https://mirrors.bfsu.edu.cn/archlinux/$repo/os/$arch' > /etc/pacman.d/mirrorlist
pacman -Syy
#+end_src
** Install
#+begin_src shell
mount ${disco}2 /mnt
mkdir -p /mnt/boot
mount ${disco}1 /mnt/boot
pacstrap /mnt base linux linux-firmware
genfstab -U /mnt >> /mnt/etc/fstab
#+end_src
** Setting
#+begin_src shell
cp /etc/pacman.d/mirrorlist /mnt/etc/pacman.d/mirrorlist
ln -sf /usr/share/zoneinfo/Asia/Shanghai /mnt/etc/localtime
arch-chroot /mnt /bin/bash -c "hwclock --systohc"
#+end_src
** Locale
*** edit /etc/locale.gen

#+begin_src shell
arch-chroot /mnt /bin/bash -c locale-gen
#+end_src

*** edit /etc/locale.conf

#+begin_src shell
echo "LANG=en_US.UTF-8
LC_CTYPE=zh_CN.UTF-8" > /mnt/etc/locale.conf
#+end_src

** Hostname
*** edit /mnt/etc/hostname
#+begin_src shell
echo "Thindrome" > /mnt/etc/hostname
#+end_src
*** edit /mnt/etc/hosts
#+begin_src shell
echo "127.0.0.1	localhost
::1 		localhost
127.0.0.1	Thindrome" > /mnt/etc/hosts
#+end_src

** Boot loader
#+begin_src shell
mkdir /mnt/boot/grub
arch-chroot /mnt /bin/bash -c "pacman -S grub efibootmgr os-prober --noconfirm"
arch-chroot /mnt /bin/bash -c "grub-mkconfig -o /boot/grub/grub.cfg"
arch-chroot /mnt /bin/bash -c "grub-install --target=x86_64-efi --efi-directory=/boot"

#+end_src
** Add user
#+begin_src shell

arch-chroot /mnt
useradd -m -U bladrome
passwd bladrome
exit
#+end_src

** switch Mirrors
** mirrors
** archlinuxcn
#+begin_src shell
pacman -S yay
yay --aururl "https://aur.tuna.tsinghua.edu.cn" --save
yay -P -g
#+end_src

** zsh
#+begin_src shell
yay -S zsh 
sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
sh -c "$(curl -fsSL https://raw.githubusercontent.com/z-shell/zinit/main/doc/install.sh)"
#+end_src

** awesomewm

#+begin_src shell
yay -S rofi unclutter slock mousepad firefox maim gpicview feh firefox mpc mpd unclutter xsel slock ttf-droid picom-git
yay -S xorg-xinit xorg-server xf86-viedo-intel xf86-viedo-nouveau  pulseaudio
yay -S lightdm xorg-server-xephyr lightdm-gtk-greeter
yay -S awesome
yay -S termite kitty
yay -S alsa-utils playerctl

git clone https://github.com/bladrome/dotconfig.git
cd dotconfig
cp -a termite ~/.config/
cp -a awesome ~/.config/

chmod u+s /usr/bin/xinit

#+end_src
** Monitor
#+begin_src shell
xrandr --output eDP1 --off
xrandr --output HDMI1 --auto
#+end_src

** Fonts
#+begin_src shell
yay -S noto-fonts
yay -S nerd-fonts-noto
yay -S ttf-hack
yay -S nerd-fonts-source-code-pro


cp Fonts /usr/share/fonts/
fc-cache

#+end_src

** Network

#+begin_src shell
yay -S wpa_supplicant dhcpcd
yay -S v2raya
#+end_src

** Emacs
#+begin_src shell
yay -S emacs
git clone --depth 1 https://github.com/seagle0128/.emacs.d.git ~/.emacs.d
#+end_src

** Input method
#+begin_src shell
yay -S fcitx-rime fcitx-configtools

#+end_src

** Texlive
#+begin_src shell

wget https://mirrors.tuna.tsinghua.edu.cn/CTAN/systems/texlive/Images/texlive2019-20190410.iso
mount texlive2019-20190410.iso mountpoint
cd moutpoint
sudo ./install-tl
#+end_src

# Session permissions

** Utils
#+begin_src shell
yay -S polkit udisks2 ntfs-3g gvfs udevil
yay -S glances tree

yay -S python-pip
yay -S zathura zathura-djvu zathura-pdf-poppler zathura-ps poppler poppler-data
yay -S mpv


yay -S mplayer
yay -S xine-lib
yay -S wget neovim unzip  pcmanfm baobab ack curl
yay -S atool bsdtar djvutxt medianinfo odt2txt jq openscad highlight

yay -S firefox
yay -S firefox-i8n-zh-cn
#+end_src
Beep /etc/modprobe.d/
#+begin_src 
blacklist pcspkr
#+end_src
** Tmux
#+begin_src shell
yay -S tmux
git clone https://github.com/gpakosz/.tmux.git
ln -sf .tmux/.tmux.conf
cp .tmux/.tmux.conf.local .
#+end_src
** Ranger
#+BEGIN_SRC shell
yay -S ranger
git clone https://github.com/alexanderjeurissen/ranger_devicons ~/.config/ranger/plugins/ranger_devicons
echo "default_linemode devicons" >> ~/.config/ranger/rc.conf

sudo pacman -S atool
git clone https://github.com/maximtrp/ranger-archives.git ~/.config/ranger/plugins/ranger-archives
cd ~/.config/ranger/plugins/ranger-archives
make install
#+END_SRC
** yay
#+BEGIN_SRC shell
gpg --keyserver pool.sks-keyservers.net --recv-keys # for linux-xanmod
yay
yay -Syyu
yay -Sc
yay -Rc
yay -Rs
yay -Q
yay -Qe
yay -Qdt
#+END_SRC
